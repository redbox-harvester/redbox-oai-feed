## BEGIN PORTING THIS TEMPLATE FOR HARVESTER
#parse("requiredPortingCode.vm")
$util.setFormat("rif")
#set($urlBase = $systemConfig.getString("http://127.0.0.1:9001/mint", "urlBase"))
## END PORTING THIS TEMPLATE FOR HARVESTER
#set($defaultOnError = "&Invalid XML placeholder... prevents ANDS Harvesting records in error&")
#set($group = $systemConfig.getString($defaultOnError, "redbox.identity", "RIF-CS Group"))

##### START Identifier resolution
#set($pidProperty = $systemConfig.getString($defaultOnError, "curation", "pidProperty"))
#set ($pid = $util.getMetadata($object, $pidProperty))
#if ("$!pid" == "")
    #set ($pid = $util.get($item, "metadata", "rdf:resource"))
    #if ("$!pid" == "")
        #set ($pid = $util.get($item, "metadata", "dc.identifier"))
    #end
#end
##### END Identifier resolution

<registryObjects xmlns="http://ands.org.au/standards/rif-cs/registryObjects" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://ands.org.au/standards/rif-cs/registryObjects http://services.ands.org.au/documentation/rifcs/1.3/schema/registryObjects.xsd">
    <registryObject group="$util.encodeXml($group)">
        <key>$util.encodeXml($pid)</key>
        <originatingSource>$urlBase</originatingSource>
        <party type="group">
            <identifier type="uri">$util.encodeXml($pid)</identifier>

            ### Name
            <name type="primary">
                <namePart type="title">$util.encodeXml($util.get($item, "data", "Name"))</namePart>
            </name>

            <location>
            ### Home Page
            #set ($value = $util.get($item, "data", "Homepage"))
            #if ("$!value" != "")
                <address>
                    <electronic type="url">
                        <value>$util.encodeXml($value)</value>
                    </electronic>
                </address>
            #end

            ### Email address
            #set ($value = $util.get($item, "data", "Email"))
            #if ("$!value" != "")
                <address>
                    <electronic type="email">
                        <value>$util.encodeXml($value)</value>
                    </electronic>
                </address>
            #end

            ### Phone Number
            #set ($value = $util.get($item, "data", "Phone"))
            #if ("$!value" != "")
                    <address>
                        <physical>
                            <addressPart type="telephoneNumber">$util.encodeXml($value)</addressPart>
                        </physical>
                    </address>
            #end
            </location>

            ### Description
            #set ($value = $util.get($item, "data", "Description"))
            #if ("$!value" != "")
            <description type="full">$util.encodeXml($value)</description>
            #else
            <description type="full">$util.encodeXml($util.get($item, "data", "Name"))</description>
            #end

            ### Relations
            #set($valueList = $item.getJsonSimpleList("relationships"))
            #if($valueList)
                #foreach($value in $valueList)
                    #if ($value.getBoolean(false, "isCurated"))
                        #set($key = $value.getString("empty", "curatedPid"))
                        #set($rel = $value.getString("hasAssociationWith", "relationship"))
                        #if ($key != "empty")
            <relatedObject>
                <key>$util.encodeXml($key)</key>
                <relation type="$util.encodeXml($rel)"/>
            </relatedObject>
                        #end
                    #end
                #end
            #end

        </party>
    </registryObject>
</registryObjects>